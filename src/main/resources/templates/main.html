<!DOCTYPE html>
<html lang="zh" xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="utf-8">
		<title>首页二</title>
		<meta name="renderer" content="webkit">
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
		<link rel="stylesheet" type="text/css" th:href="@{/plugins/layui/css/layui.css}" media="all">
		<link rel="stylesheet" type="text/css" th:href="@{/dk/css/font-awesome-4.7.0/css/font-awesome.min.css}" media="all">
		<link rel="stylesheet" type="text/css" th:href="@{/dk/css/public.css}" media="all">
		<style type="text/css">
			.layui-card {
				border: 1px solid #f2f2f2;
				border-radius: 5px;
			}

			.icon {
				margin-right: 10px;
				color: #1aa094;
			}

			.icon-cray {
				color: #ffb800 !important;
			}

			.icon-blue {
				color: #1e9fff !important;
			}

			.icon-tip {
				color: #ff5722 !important;
			}

			.layuimini-qiuck-module {
				text-align: center;
				margin-top: 10px
			}

			.layuimini-qiuck-module a i {
				display: inline-block;
				width: 100%;
				height: 60px;
				line-height: 60px;
				text-align: center;
				border-radius: 2px;
				font-size: 30px;
				background-color: #F8F8F8;
				color: #333;
				transition: all .3s;
				-webkit-transition: all .3s;
			}

			.layuimini-qiuck-module a cite {
				position: relative;
				top: 2px;
				display: block;
				color: #666;
				text-overflow: ellipsis;
				overflow: hidden;
				white-space: nowrap;
				font-size: 14px;
			}

			.welcome-module {
				width: 100%;
				height: 210px;
			}

			.panel {
				background-color: #fff;
				border: 1px solid transparent;
				border-radius: 3px;
				-webkit-box-shadow: 0 1px 1px rgba(0, 0, 0, .05);
				box-shadow: 0 1px 1px rgba(0, 0, 0, .05)
			}

			.panel-body {
				padding: 10px
			}

			.panel-title {
				margin-top: 0;
				margin-bottom: 0;
				font-size: 12px;
				color: inherit
			}

			.label {
				display: inline;
				padding: .2em .6em .3em;
				font-size: 90%;
				font-weight: 700;
				line-height: 1;
				color: #fff;
				text-align: center;
				white-space: nowrap;
				vertical-align: baseline;
				border-radius: .25em;
				margin-top: .3em;
			}

			.layui-red {
				color: red
			}

			.main_btn>p {
				height: 40px;
			}

			.layui-bg-number {
				background-color: #F8F8F8;
			}

			.layuimini-notice:hover {
				background: #f6f6f6;
			}

			.layuimini-notice {
				padding: 7px 16px;
				clear: both;
				font-size: 12px !important;
				cursor: pointer;
				position: relative;
				transition: background 0.2s ease-in-out;
			}

			.layuimini-notice-title,
			.layuimini-notice-label {
				padding-right: 70px !important;
				text-overflow: ellipsis !important;
				overflow: hidden !important;
				white-space: nowrap !important;
			}

			.layuimini-notice-title {
				line-height: 28px;
				font-size: 14px;
			}

			.layuimini-notice-extra {
				position: absolute;
				top: 50%;
				margin-top: -8px;
				right: 16px;
				display: inline-block;
				height: 16px;
				color: #999;
			}

			body {
				overflow: scroll;
			}

			/* scrollbar */
			::-webkit-scrollbar {
				width: 0;
				height: 0;
			}

			::-webkit-scrollbar-track {
				background-color: transparent;
			}

			::-webkit-scrollbar-thumb {
				border-radius: 5px;
				background-color: rgba(0, 0, 0, 0.3);
			}
		</style>
	</head>
	<body>
		<div class="layuimini-container">
			<div class="layuimini-main">
				<div class="layui-row layui-col-space15">
					<div class="layui-col-md12">
						<div class="layui-row layui-col-space15">
							<div class="layui-col-md12">
								<div class="layui-card">
									<div class="layui-card-header"><i class="fa fa-credit-card icon icon-blue"></i>快捷入口</div>
									<div class="layui-card-body">
										<div class="welcome-module" lay-filter="iframe-tab">
											<div class="layui-row layui-col-space10 layuimini-qiuck">
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/stopAlarm" data-title="停电告警" data-icon="fa fa-window-maximize">
														<i class="fa fa-window-maximize"></i>
														<cite>停电告警</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/topo" data-title="台区拓扑" data-icon="fa fa-gears">
														<i class="fa fa-gears"></i>
														<cite>台区拓扑</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/lineLose" data-title="线损分析" data-icon="fa fa-hourglass-end">
														<i class="fa fa-hourglass-end"></i>
														<cite>线损分析</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/loadRate" data-title="负载率分析" data-icon="fa fa-file-text">
														<i class="fa fa-file-text"></i>
														<cite>负载率分析</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/lineLose" data-title="三相电压分析" data-icon="fa fa-hourglass-end">
														<i class="fa fa-hourglass-end"></i>
														<cite>三相电压分析</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/totalPower" data-title="总功率分析" data-icon="fa fa-file-text">
														<i class="fa fa-file-text"></i>
														<cite>总功率分析</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/hz/alarm/alarmInfoPage" data-title="报警信息" data-icon="fa fa-hourglass-end">
														<i class="fa fa-hourglass-end"></i>
														<cite>报警信息</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/planWrite" data-title="计划停电录入" data-icon="fa fa-file-text">
														<i class="fa fa-file-text"></i>
														<cite>计划停电录入</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/device" data-title="设备管理" data-icon="fa fa-dot-circle-o">
														<i class="fa fa-dot-circle-o"></i>
														<cite>设备管理</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/workOrderPage" data-title="工单管理" data-icon="fa fa-calendar">
														<i class="fa fa-calendar"></i>
														<cite>工单管理</cite>
													</a>
												</div>

												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/sysLog" data-title="日志管理" data-icon="fa fa-snowflake-o">
														<i class="fa fa-snowflake-o"></i>
														<cite>系统日志</cite>
													</a>
												</div>
												<div class="layui-col-xs2 layuimini-qiuck-module">
													<a href="javascript:;" data-iframe-tab="/sys" data-title="系统基本情况" data-icon="fa fa-shield">
														<i class="fa fa-shield"></i>
														<cite>系统监控</cite>
													</a>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-card">
									<div class="layui-card-header"><i class="fa fa-warning icon"></i>智能终端数据统计</div>
									<div class="layui-card-body">
										<div class="welcome-module">
											<div class="layui-row layui-col-space10">
												<div class="layui-col-xs6">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-blue">实时</span>
																<h5>总设备数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="totalDeviceCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs6">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-cyan">实时</span>
																<h5>设备在线数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="onlineDeviceCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs6">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-orange">实时</span>
																<h5>设备离线数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="offDeviceCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs6">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-green">实时</span>
																<h5>停电用户数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="offUserCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="layui-col-md6">
								<div class="layui-card">
									<div class="layui-card-header"><i class="fa fa-warning icon"></i>海准数据统计</div>
									<div class="layui-card-body">
										<div class="welcome-module">
											<div class="layui-row layui-col-space10">
												<div class="layui-col-xs4">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-blue">实时</span>
																<h5>总台区数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="areaCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs4">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-cyan">实时</span>
																<h5>总支线数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="lineCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs4">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-orange">实时</span>
																<h5>总用户数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="userCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs4">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-green">实时</span>
																<h5>海准匹配台区数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="hzAreaCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs4">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-green">实时</span>
																<h5>海准匹配用户数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="hzUserCount">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
												<div class="layui-col-xs4">
													<div class="panel layui-bg-number">
														<div class="panel-body">
															<div class="panel-title">
																<span class="label pull-right layui-bg-green">实时</span>
																<h5>海准停电用户数</h5>
															</div>
															<div class="panel-content">
																<h1 class="no-margins" id="userHZ">0</h1>
																<small>当前分类总记录数</small>
															</div>
														</div>
													</div>
												</div>
											</div>
										</div>
									</div>
								</div>
							</div>

							<div class="layui-col-md4">
								<div class="layui-card">
									<div class="layui-card-header"><i class="fa fa-line-chart icon"></i>台区用户统计表</div>
									<div class="layui-card-body">
										<div id="echarts-records" style="width: 100%;min-height:35vh"></div>
									</div>
								</div>
							</div>
							<div class="layui-col-md4">
								<div class="layui-card">
									<div class="layui-card-header"><i class="fa fa-bullhorn icon icon-tip"></i>设备在线离线占比</div>
									<div class="layui-card-body layui-text">
										<div id="echarts-deviceOnline" style="width: 100%;min-height:35vh"></div>
									</div>
								</div>
							</div>
							<div class="layui-col-md4">
								<div class="layui-card">
									<div class="layui-card-header"><i class="fa fa-fire icon"></i>系统信息</div>
									<div class="layui-card-body layui-text" style="min-height:35vh">
										<table class="layui-table">
											<colgroup>
												<col width="100">
												<col>
											</colgroup>
											<tbody id="sysInfoTbody">
												<script type="text/html" id="sysInfo">
													<tr>
														<td>系统名称</td>
														<td>{{d.sysName}}</td>
													</tr>
													<tr>
														<td>当前版本</td>
														<td>{{d.version}}</td>
													</tr>
													<tr>
														<td>上线日期</td>
														<td>{{d.online}}</td>
													</tr>
													<tr>
														<td>技术支持</td>
														<td>{{d.manuFactor}}</td>
													</tr>
												</script>
											</tbody>
										</table>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<a th:href="${#httpServletRequest.getServerName() + ':' + #request.getServerPort() + #request.getContextPath() + '/'}"
			 class="layui-hide" id="contextPath"></a>
		</div>
		<th:block th:include="config :: footer" />
		<script th:inline="javascript">
			let temp_flag = false;
			layui.config({
				base: '/dk/js/'
			}).extend({
				ws: 'ws'
			}).use(['layer', 'echarts', 'setting', 'laytpl', 'element', 'ws', 'myAjax'], function() {
				let $ = layui.jquery,
					layer = layui.layer,
					laytpl = layui.laytpl,
					setting = layui.setting,
					echarts = layui.echarts,
					ws = layui.ws,
					myAjax = layui.myAjax,
					element = layui.element(),
					ws_url = "ws://" + $('#contextPath').attr('href') + 'websocket/',
					url = {
						wsUrl: ws_url + 'DEVICELINENUM'
					};
				let onlineDeviceCount, offDeviceCount;
				//设备在线率报表
				let active = {
					onMessage: function() {
						let wSocket = ws.make(url.wsUrl);
						wSocket.onmessage = function(msg) {
							let result = JSON.parse(msg.data);
							if (result.symbol === 'DEVICELINENUM') {
								$("#totalDeviceCount").text(result.sumCount);
								$("#onlineDeviceCount").text(result.onlineCount);
								$("#offDeviceCount").text(result.sumCount - result.onlineCount);
								let optionDevice = {
									series: [{
										data: [{
												value: result.onlineCount,
												name: '设备在线率'
											},
											{
												value: result.sumCount - result.onlineCount,
												name: '设备离线率'
											},
										],
									}]
								}
								echartsDevice.setOption(optionDevice);
							}
						}
					},
				}
				active.onMessage();

				let echartsDevice = echarts.init(document.getElementById('echarts-deviceOnline'), 'walden');

				let echartsRecords = echarts.init(document.getElementById('echarts-records'), 'walden');

				//数据初始化
                /*myAjax.ajax('get', '/indexCount', null, function(res) {
                    let optionDevice = {
                        tooltip: {
                            trigger: 'item',
                            formatter: '{a} <br/>{b} : {c} ({d}%)'
                        },
                        legend: {
                            orient: 'vertical',
                            left: 'left',
                            data: ['设备在线率', '设备离线率']
                        },
                        series: [{
                            name: '访问来源',
                            type: 'pie',
                            radius: '55%',
                            center: ['50%', '60%'],
                            data: [{
                                    value: res.data.onlineCount,
                                    name: '设备在线率'
                                },
                                {
                                    value: res.data.sumCount - res.data.onlineCount,
                                    name: '设备离线率'
                                },
                            ],
                            emphasis: {
                                itemStyle: {
                                    shadowBlur: 10,
                                    shadowOffsetX: 0,
                                    shadowColor: 'rgba(0, 0, 0, 0.5)'
                                }
                            }
                        }]
                    };
                    echartsDevice.setOption(optionDevice);
                    $("#totalDeviceCount").text(res.data.sumCount);
                    $("#onlineDeviceCount").text(res.data.onlineCount);
                    $("#offDeviceCount").text(res.data.sumCount - res.data.onlineCount);
                    $("#offUserCount").text(res.data.stopPowerCount);

                    $("#areaCount").text(res.data.areaCount);
                    $("#hzAreaCount").text(res.data.hzAreaCount);
                    $("#hzUserCount").text(res.data.hzUserCount);
                    $("#lineCount").text(res.data.lineCount);
                    $("#userCount").text(res.data.userCount);
                    $("#userHZ").text(res.data.userHZ);
					let optionRecords = {
						toolbox: {
							show: true,
							orient: 'horizontal',
							left: 'right',
							feature: {
								mark: {
									show: true
								},
								dataView: {
									show: true,
									readOnly: false
								},
								restore: {
									show: true
								},
								saveAsImage: {
									show: true
								}
							}
						},
						tooltip: {
							trigger: 'axis',
							axisPointer: { // 坐标轴指示器，坐标轴触发有效
								type: 'shadow' // 默认为直线，可选为：'line' | 'shadow'
							}
						},
						//X轴信息
						xAxis: [{
							type: 'category',
							data: ['台区', '支线', '用户'],
							name: '类别',
							axisTick: {
								alignWithLabel: true
							}
						}],
						//Y轴信息
						yAxis: [{
							type: 'value',
							name: '个'
						}],
						series: [{
							name: '数量',
							type: 'bar',
							itemStyle: {
								normal: {
									color: function(params) {
										// 给出颜色组
										var colorList = ['#F56C6C', '#E6A23C', '#909399'];
										return colorList[params.dataIndex]
									},
								}
							},
							//柱状图宽度
							barWidth: '30%',
							//柱状图数值
							data: [res.data.areaCount, res.data.lineCount, res.data.userCount],
							label: {
								normal: {
									show: true,
									position: 'top'
								},
							},
						}]
					};
					echartsRecords.setOption(optionRecords);
				})*/

				$('body').on('click', '[data-iframe-tab]', function() {
					let obj = this;
					$.each($("#larry-nav-side dd", parent.document), function(i, s) {
						let temp = $(s).children("a").attr("data-url");
						if (temp != undefined) {
							let temp_text = $(s).children("a").children("span").text();
							if (temp_text.trim() == $(obj).attr("data-title").trim()) {
								if (!temp_flag) {
									$(s).click();
									let temp_flag = true;
								}
								$(s).click();
							}
						}
					});
				})

				laytpl(sysInfo.innerHTML).render(setting, function(html) {
					$('#sysInfoTbody').append(html);
				});
				// echarts 窗口缩放自适应
				window.onresize = function() {
					echartsRecords.resize();
					echartsDevice.resize();
				}
			});
		</script>
	</body>
</html>
